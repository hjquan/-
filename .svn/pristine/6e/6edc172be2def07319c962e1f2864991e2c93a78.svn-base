<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title></title>
    <link rel="stylesheet" href="../../../../commonUi/aui/css/aui.css">
    <link rel="stylesheet" href="../../../../commonUi/timeAxis/libs/index.css">

    <style>
        html,
        body {
            height: 100%;
        }

        .height {
            height: 100%;
            width: 100%;
        }

        .apply-info {
            width: 100%;
            padding: 10px;
            background: #ffffff;
            margin-bottom: 0.2rem;
            /* margin-bottom: 0.2rem; */
        }

        .apply-info header {
            display: flex;
            align-items: center;
        }

        .apply-info header img {
            width: 0.9rem;
            height: 0.9rem;
        }

        .list-ul {
            margin-top: 0.5rem;
            padding-left: 0.5rem;
        }

        .list-ul li {
            margin-top: 0.5rem;
            display: flex;
        }

        .list-titile {
            width: 5rem;
            color: #a6a6a6;
            margin-right: 1rem;
        }

        .list-text {
            flex: 1;
            text-align: justify;
            text-justify: newspaper;
            word-break: break-all;
        }

        .footer {
            width: 100%;
            height: 3rem;
            position: fixed;
            bottom: 0;
            background: #ffffff;
            display: flex;
            align-items: center;
            justify-content: center;
            -moz-box-shadow: 2px 2px 5px #333333;
            -webkit-box-shadow: 2px 2px 5px #333333;
            box-shadow: 2px 2px 5px #333333;
            display: none;
        }

        .examine {
            width: 80%;
            height: 2rem;
            border-radius: 2px;
            font-weight: bold;
            color: #ffffff;
            background: #2a82e4;
            line-height: 2rem;
            text-align: center;
        }

        /* .progess-bar {
            width: 100%;
            height: 60px;
        }

        .ball {
            width: 20px;
            height: 20px;
            border-radius: 10px;
            margin-left: 20px;
        }

        .progress {
            width: 2px;
            height: 50px;
            margin-left: 29px;
        }

        .detail {
            margin-left: 40px;
            float: left;
            font-size: 12px;
            color: #FF5722;
            position: relative;
            top: -20px;
            left: 5px;
        }

        .flow-detail {
            margin: 2px;
        }

        .active {
            background-color: #FF5722
        }

        .negative {
            background-color: #9F9F9F
        }

        .negative-color {
            color: #9F9F9F;
        }

*/
        .show-img {
            width: 2rem;
            height: 2rem;
        }

        .footer-img {
            width: 1rem;
            height: 1rem;
            margin-right: 0.5rem;
        }

        .displayFlex {
            display: flex;
        }

        .bg_ff {
            background-color: #fff;
        }

        .list {
            padding-bottom: 20px
        }

        .list .item-inner .dot i {
            left: 2px;
        }

        .btnBox .rectificationBtn {
            width: 335px;
            height: 40px;
            line-height: 40px;
            text-align: center;
            background: rgba(5, 143, 253, 1);
            border-radius: 6px;
            color: #fff;
            cursor: pointer;
            margin: 0 auto;
            margin-bottom: 5px
        }

        .btnBox .rectification {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .imgBox {
            display: flex;
            justify-content: flex-start;
        }

        .showimg {
            width: 50px;
            height: 50px;
            margin-right: 5px;
        }

        .img_t {
            width: 24px;
            height: 24px;
            margin-left: 8px;
        }

        .apply-form {
            width: 100%;
            height: 4rem;
            border: 1px #e5e5e5 solid;
            margin: 10px 0;
            position: relative;
            padding: 10px 10px;
        }

        .mian-item {
            width: 100%;
            background-color: #ffffff;
            padding: 0 10px;
            padding-top: 15px;
        }

        .mian-item p {
            font-size: 16px;
            font-weight: 400;
            color: rgba(51, 51, 51, 1);
        }

        .apply-form-img {
            width: 1rem;
            height: 1rem;
            display: inline;
        }

        .apply-form-titile {
            flex: 1;
            line-height: -5px;
            margin-left: 5px;
            overflow: hidden;
            /*对超出容器的部分强制截取，高度不确定则换行*/
            text-overflow: ellipsis;
            /*显示省略符号来代表被修剪的文本。*/
            white-space: nowrap;
        }

        .apply-form-header {
            display: flex;
            align-items: center;
        }

        .apply-article {
            width: 2.8rem;
            height: 1.2rem;
            border-radius: 3px;
            border: 1px darkturquoise solid;
            background-color: #ffffff;
            text-align: center;
            line-height: 1.1rem;
            margin-right: 1rem;
            font-size: 0.6rem;
            border: 1px #008000 solid;
            color: #008000;
            margin-left: 1.2rem;
        }

        .apply-time {
            font-size: 0.6rem;
            color: #a6a6a6;
        }
    </style>
</head>

<body>
    <section id="app" class="height">
        <section style="padding-bottom: 2rem;">
            <article class="apply-info" style="padding-top: 0px;">
                <header>
                    <img src="../../../../image/temporaryWork/title.png" alt="">
                    <h3>申请详情</h3>
                </header>
                <ul class="list-ul">
                    <li>
                        <span class="list-titile">提交时间</span>
                        <span class="list-text" v-text="applyInfo.createTime">2020/09/01 19:29</span>
                    </li>
                    <li>
                        <span class="list-titile">申请人</span>
                        <span class="list-text" v-text="applyInfo.createUserName">张大山</span>
                    </li>
                    <li>
                        <span class="list-titile">关联申请单</span>
                        <span class="list-text">
                            <div v-for="(item,index) in applyInfo.applyList" @click="selectApplyInfo()">
                                <div class="apply-form">
                                    <div class="apply-form-header">
                                        <img class="apply-form-img" src="../../../../image/temporaryWork/apply-ico.png"
                                            alt="">
                                        <span class="apply-form-titile" v-text="item.subjectMatterName">其他无效成本</span>
                                    </div>
                                    <div class="apply-form-header" style="margin-top: 0.5rem;">
                                        <article class="apply-article">已通过</article>
                                        <span class="apply-time" v-text="item.createTime.slice(0,11)">2020-08-19</span>
                                    </div>
                                </div>
                            </div>
                        </span>
                    </li>
                    <li>
                        <span class="list-titile">实际用工类型</span>
                        <span class="list-text" v-text="applyInfo.typeName">劳务借用工人</span>
                    </li>
                    <li>
                        <span class="list-titile">出工班组名称</span>
                        <span class="list-text" v-text="applyInfo.workerTeamName">李大马</span>
                    </li>
                </ul>
            </article>
            <article class="apply-info" v-for="(item,index) in applyInfo.workerDetails">
                <header>
                    <img src="../../../../image/temporaryWork/title1.png" alt="">
                    <h3> 预计用工明细<span v-text="index+1"></span> </h3>
                </header>
                <ul class="list-ul">
                    <li>
                        <span class="list-titile">工种名称</span>
                        <span class="list-text" v-text="item.workerTypeName">技工</span>
                    </li>
                    <li>
                        <span class="list-titile">工人数量</span>
                        <span class="list-text"> <span v-text="item.workerNumber"></span> <span
                                v-if="item.workerNumber"> 人</span></span>
                    </li>
                    <li>
                        <span class="list-titile">工种名称</span>
                        <span class="list-text" v-text="item.workerTypeName">技工</span>
                    </li>
                    <li>
                        <span class="list-titile">开始时间</span>
                        <span class="list-text" v-text="item.startTime">1</span>
                    </li>
                    <li>
                        <span class="list-titile">结束时间</span>
                        <span class="list-text" v-text="item.endTime">8 小时</span>
                    </li>
                    <li>
                        <span class="list-titile">工日单价</span>
                        <span class="list-text"><span v-text="item.workPrice"></span>
                            <span v-if="item.workPrice"> 元</span></span>
                    </li>
                    <li>
                        <span class="list-titile">预计金额</span>
                        <span class="list-text"> <span v-text="item.money"></span>(<span
                                v-text="item.capitalization"></span>)</span>
                    </li>
                </ul>
            </article>
            <article class="apply-info">
                <ul class="list-ul">
                    <li>
                        <span class="list-titile">总费用金额</span>
                        <span class="list-text"><span v-text="applyInfo.totalMoney"></span>(<span
                                v-text="applyInfo.totalMoneyText"></span>)</span>
                    </li>
                    <li>
                        <span class="list-titile">费用承担方式</span>
                        <span class="list-text" v-text="applyInfo.bearTypeName">项目部与责任班组分摊</span>
                    </li>
                    <li v-if="applyInfo.bearTypeName ==='责任班组承担' || applyInfo.bearTypeName ==='项目部与责任班组分摊'">
                        <span class="list-titile">责任班组名称</span>
                        <span class="list-text" v-text="applyInfo.responsibleTeamName">李大马</span>
                    </li>
                    <li v-if="applyInfo.bearTypeName ==='项目部与责任班组分摊'">
                        <span class="list-titile">责任班组承担比例系数</span>
                        <span class="list-text"><span v-text="applyInfo.bearProportion"></span> <span> %</span></span>
                    </li>
                    <li v-if="applyInfo.bearTypeName ==='责任班组承担' || applyInfo.bearTypeName ==='项目部与责任班组分摊'">
                        <span class="list-titile">预计责任班组承担费用</span>
                        <span class="list-text"><span v-text="applyInfo.responsibleTeamMoney"></span>(<span
                                v-text="applyInfo.responsibleTeamMoneyText"></span>)</span>
                    </li>
                    <li>
                        <span class="list-text"
                            style="display: flex;flex-direction: row;flex-wrap: wrap;justify-content: flex-start;">
                            <img class="show-img" v-for="(item,index) in applyInfo.imgUrl" :src="item.compressUrl"
                                @click="imgSee(applyInfo.imgUrl,index)" alt="">
                        </span>
                    </li>
                </ul>
            </article>
            <article class="apply-info">
                <header>
                    <img src="../../../../image/temporaryWork/title1.png" alt="">
                    <h3> 审批信息</h3>
                </header>
            </article>
            <article class="apply-info" style="padding-left: 0px;">
                <div class="list bg_ff">
                    <div class="item-inner flex-box-x" :class="{'active':index == 0}" style="justify-content:baseline"
                        v-for="(items,index) in taskHandleStep">
                        <div class="item-date">
                            <div class="date" v-text="items.createTime" style="font-size:10px;"></div>
                        </div>
                        <div class="dot"><i></i></div>
                        <div class="item-main col-xs-x aui-ellipsis-1">
                            <div class="item-type aui-ellipsis-1" style="font-size:14px;" v-cloak
                                v-text="items.assigneeName"></div>
                            <div class="item-content" style="font-size:14px;" v-cloak v-if="items.content"
                                v-text="items.content"></div>

                            <div class="imgBox" v-if="items.imgUrl && items.imgUrl.length">
                                <img class="showimg" v-for="(item,index) in items.imgUrl" :src="item.compressUrl" alt=""
                                    @click="imgSee(applyInfo.imgUrl,index)" ">
                            </div>
                        </div>
                        <span class=" statu" v-cloak v-text="items.actName"></span>
                            </div>
                        </div>
            </article>
        </section>
        <section class="footer">
            <article class="examine" @click="approve()">
                审批
            </article>
        </section>
        <section class="footer ">
            <article class="displayFlex" v-if="applyInfo.state != '0'" @click="cancellation()"
                style="margin-right: 5rem;">
                <img class="footer-img" src="../../../../image/temporaryWork/cancellation.png " alt=""> 作废
            </article>
            <article class="displayFlex" @click="anew()">
                <img class="footer-img" src="../../../../image/temporaryWork/anew.png" alt=""> 重新提交
            </article>
        </section>
    </section>

    <script src="../../../../script/api.js"></script>
    <script src="../../../../script/vue.js"></script>
    <script src="../../../../script/aui-dialog.js"></script>
    <script src="../../../../script/sha1.js"></script>
    <script src="../../../../script/common.js"></script>
    <script>
        apiready = function () {
            //侵入式导航栏
            $api.fixStatusBar($api.dom('header'));
            var offset = $api.offset($api.byId('header'));
            var vm = new Vue({
                el: '#app',
                data: {
                    confirmId: api.pageParam.confirmId,
                    applyInfo: {},
                    taskHandleStep: {}
                },
                created: function () {
                    this.getWorkerApplyById();
                    this.getTaskHandleStepLists();
                    var that = this;
                    api.addEventListener({
                        name: 'workerConfirm'
                    }, function (ret, err) {
                        if (ret) {
                            that.confirmId = ret.value.confirmId;
                            that.getWorkerApplyById();
                            that.getTaskHandleStepLists();
                        }
                    });
                },
                methods: {
                    selectApplyInfo: function (item) {
                        api.openWin({
                            name: 'temporary',
                            url: '../temporary/temporary_edit.html',
                            bounces: false,
                            pageParam: { applyId: items.applyId }
                        });
                    },
                    // //图片查看
                    imgSee: function (imgInfo, index) {
                        var url = [];
                        imgInfo.map(function (item) {
                            url.push(item.compressUrl);
                        });
                        url.push();
                        console.log("数据：" + JSON.stringify(url));
                        var photoBrowser = api.require('photoBrowser');
                        photoBrowser.open({
                            images: url,
                            activeIndex: index,
                            // placeholderImg: 'widget://res/img/apicloud.png',
                            bgColor: '#000'
                        }, function (ret, err) {
                            if (ret) {
                                if (ret.eventType === 'click') {
                                    photoBrowser.close();
                                }
                            } else { }
                        });
                    },
                    //重新提交
                    anew: function () {
                        var that = this;
                        api.openWin({
                            name: 'temporary_affirm',
                            url: 'temporary_affirm.html',
                            bounces: false,
                            pageParam: { applyInfo: that.applyInfo }
                        });
                    },
                    //作废
                    cancellation: function () {
                        var that = this;
                        api.confirm({
                            title: '警告',
                            msg: '确认作废申请',
                            buttons: ['确认', '取消']
                        }, function (ret, err) {
                            if (ret) {
                                if (ret.buttonIndex == 1) {
                                    var prame = {
                                        businessId: that.confirmId,
                                        ccUserId: "",
                                        state: "0",
                                        content: "",
                                        msgContent: "",
                                        msgTitle: "",
                                        msgModule: "",
                                    };
                                    console.log("参数：" + JSON.stringify(prame));
                                    $app.post(
                                        false,
                                        editworkerconfirmURL,
                                        prame,
                                        function (ret) {
                                            api.sendEvent({
                                                name: 'cancellation',
                                            });
                                            api.closeWin();
                                        }
                                    )
                                }
                            }
                        });


                    },
                    //审批函数
                    approve: function () {
                        api.openWin({
                            name: 'check',
                            url: 'check.html',
                            pageParam: {
                                confirmId: this.confirmId
                            }
                        });
                    },
                    //获取单个数据
                    getWorkerApplyById: function () {
                        var that = this;
                        var prame = {
                            confirmId: this.confirmId
                        }
                        $app.post(
                            false,
                            getWorkerConfirmByIdURL,
                            prame,
                            function (ret) {
                                console.log("获取单个数据：" + JSON.stringify(ret));
                                that.applyInfo = ret.obj
                                that.applyInfo.totalMoneyText = $app.changeNumMoneyToChinese(that.applyInfo.totalMoney);
                                that.applyInfo.responsibleTeamMoneyText = $app.changeNumMoneyToChinese(that.applyInfo.responsibleTeamMoney);
                                that.applyInfo.workerDetails.map(function (item) {
                                    item.capitalization = $app.changeNumMoneyToChinese(item.money)
                                });
                                if (that.applyInfo.createUserId === $api.getStorage('enterLoginInfo').userId) {
                                    document.getElementsByClassName("footer")[1].style.display = "flex"
                                }
                                if (that.applyInfo.handleUserId === $api.getStorage('enterLoginInfo').userId && that.applyInfo.state != 0 && that.applyInfo.state != 2) {
                                    document.getElementsByClassName("footer")[0].style.display = "flex"
                                } else {
                                    document.getElementsByClassName("footer")[0].style.display = "none"
                                }
                            }
                        )
                    },
                    //获取流程处理步骤列表
                    getTaskHandleStepLists: function () {
                        var that = this;
                        var prame = {
                            confirmId: this.confirmId
                        }
                        $app.post(
                            false,
                            getTaskHandleStepWorkerconfirm,
                            prame,
                            function (ret) {
                                console.log("参数：" + JSON.stringify(prame));
                                console.log("获取流程处理步骤列表:" + JSON.stringify(ret));
                                that.taskHandleStep = ret.obj
                            }
                        )
                    },
                }
            });
        }
    </script>
</body>

</html>